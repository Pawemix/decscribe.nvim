- [x] list out todos
- [x] `:Decscribe`
- [x] clean up the view - too much metadata
- [x] separate tasks between each other
- [x] virtual buffer like in Octo/Oil
    * i.e. without corresponding file & with overriden load/save functions
    * [x] implement save (`:w`)
    * [x] save should modify `modified`
    * [x] implement load (`:e!`)
    * [x] custom name (`vim.api.nvim_set_buf_name`)
- [x] refactor `set_entry` to NOT use `decscribe.py`, but ONLY Lua + FFI
    - [x] attach a todo's vcal form to every todo_json
    - [x] actual refactor
- [x] fork libdecsync to silence/redirect Logging
- [x] remove `decscribe.py` completely | optimize libdecsync calls (too slow currently)
    - is it python?
    - is it ical parsing?
    - is it costly all-entries-recalculations?
    - everything is fast except (some part of decscribe.py) (maybe executing ALL entries too often?)
- [x] what's causing this long lag during first one/several `:w`'s? (buffer changes during BufWriteCmd)
- [x] handle editing many todo items simultaneously
- [x] handle adding new items
- [x] handle removing
- [x] `:DECSCRIBE COLLECTION-NAME`
- [x] `:Decscribe` - provide autocompletion for existing collections
- [x] `:Decscribe PATH-TO-DECSYNC-DIR COLLECTION-NAME`
- [x] `:Decscribe` - simple path autocompletion for 1st arg
- [x] categories/tags
- [x] Tasks.org compliance?: sort categories alphabetically
- [x] priority as a number
- [x] priority as a letter
- [x] due dates
- [x] ical: if CATEGORIES are empty, remove the Ical entry altogether
- [x] ical: if any generic Ical field is empty, remove the Ical entry altogether
- [x] due datetimes
- [x] app.lua: write_buffer: refactor to impureim sandwich for easier testing
- [x] start dates (syntax: `- [ ] 2022-06-12 .. 2022-06-29 09:00`)
- [x] start datetimes (syntax: `- [ ] 2022-06-12 09:00 .. 2022-06-29 09:00`)
- [x] app.lua: read_buffer: refactor to impureim sandwich for easier testing
- [x] refactor Tasks class to simple functions on a simple struct -> collections.lua
- [ ] replace decsync bindings with custom implementation
    - [x] is path a decsync dir
    - [x] list collections
    - [x] retrieve all task-collection's icals
    - [x] update task collection
        - [x] updates
        - [x] creations
        - [x] removals
    - [ ] if nonexistent <app-id>/ dir - create one
- [ ] `app.open_buffer.list_collections_fn` - fail on coll path pointing at nonexistent (ds-)dir
- [ ] app.lua: read_buffer: refactor to impureim sandwich for easier testing
- [ ] start dates (syntax: `- [ ] 2022-06-12 .. 2022-06-29 09:00`)
- [ ] start datetimes (syntax: `- [ ] 2022-06-12 09:00 .. 2022-06-29 09:00`)
- [ ] subtasks
- [ ] description
- [ ] refactor to make writing tests less of a chore?
    - [ ] split app into data-format-agnostic core and two mappers (`read`er (parser) and `show`er) - ICal & Markdown
    - such that adding new fields to the whole app is like tweaking a declarative configuration passed into these mappers; the unit tests shall only test the generic part
- [ ] calculate hash of each task to identify which tasks were just moved around the file, to avoid unnecessary creations + removals
- [ ] if non-decsync-dir and/or non-collection given, create it
- [ ] refactor ical struct to a map with a default sorting, instead of a list
- [ ] consider `nvim_buf_attach` to continuously watch for buffer changes
- [ ] handle complex hunks (mix of changes and removals/additions)
- [ ] built-in <c-a>/<c-i> override to cycle through `[HML]` priorities
- [ ] when existing items are moved, retain their UIDs instead of deleting and creating?
- [ ] use extmarks for syntax highlighting?
- [ ] use extmarks for diff-handling?
- [ ] preconfigured ds-dirs:
    - `:Decscribe NAME-OF-PRECONFIGURED-DECSYNC-DIR COLLECTION`; and/or
    - `:<range>Decscribe COLLECTION`; and/or
    - `:<range>Decscribe`
- [ ] fix `repopulate_buffer` disabling highlighting for some reason
- [ ] don't reestablish libdecsync connection so often (i.e. with every repopulate_buffer) - keep it long living
- [ ] memory leak - free `Decsync*` connections after the buffer is repopulated (a brand new connection is established)
- [ ] with already established libdecsync connection, only refresh *changed* entries, not all
- [ ] complex todo view, like Octo's PR view
- [ ] multiple DS buffers can be open (different collections and/or DS dirs)
- [ ] `:Decscribe PATH-TO-DECSYNC-DIR COLLECTION-NAME` - if collection not provided, create a new one with given name
- [ ] `:Decscribe` - DS dir path autocompletion for *preconfigured* DS dirs
- [ ] `:Decscribe` - DS dir path autocompletion for dynamically searched DS dirs
    - seeking .decsync-info files or using `lds.check_decsync_info`
    - up to `n` levels of directory recursion, not to overdo computation
    - async? to not block UI thread
- [ ] at this point, todos collection view should be like just an MD file with nested lists
- [ ] delete todo line(s) from one coll/ds-dir, and paste it/them into another => whole ICals are ported between colls/ds-dirs
    - i.e. all metadata like timestamps, uids etc. is preserved
- [ ] edit and save todos (simple view of raw VDIR of given item)
- [ ] ...
- [ ] similar for calendar?
